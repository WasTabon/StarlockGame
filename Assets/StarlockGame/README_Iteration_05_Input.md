# Итерация 5: Ввод и матчинг фигур

## Что добавлено

### Новые скрипты

**Gameplay:**
- `InputManager.cs` — обработка тапов/кликов по фигурам
- `MatchManager.cs` — логика матчинга (проверка пар, начисление очков)

**Editor:**
- `StarlockSetup_05_Input.cs` — настройка ввода и матчинга

### Обновлённые скрипты

- `GameplayController.cs` — связывает все системы, обработка победы/поражения

---

## Установка

### 1. Скопируйте файлы

| Файл | Куда |
|------|------|
| `InputManager.cs` | `Assets/StarlockGame/Scripts/Gameplay/` |
| `MatchManager.cs` | `Assets/StarlockGame/Scripts/Gameplay/` |
| `GameplayController.cs` | `Assets/StarlockGame/Scripts/Gameplay/` (заменить!) |
| `StarlockSetup_05_Input.cs` | `Assets/StarlockGame/Editor/` |

### 2. Откройте Gameplay сцену

### 3. Запустите Editor скрипт

**Starlock → Setup Input & Matching (Iteration 5)**

### 4. Сохраните сцену

---

## Как работает

### Тап по фигуре:
1. `InputManager` детектит тап/клик
2. Проверяет что не над UI (EventSystem)
3. Находит фигуру под курсором (Raycast)
4. Если фигура в состоянии `Outside` и круг не полон → отправляет внутрь

### Перемещение внутрь:
1. `Shape.MoveInside()` — анимация полёта к центру (DOTween)
2. После прибытия состояние меняется на `Inside`
3. Фигура получает случайный импульс (отскакивает)

### Матчинг:
1. `MatchManager` следит за фигурами внутри круга
2. Проверяет пары: совпадают ли `Type` и `Color`
3. Если да → обе фигуры исчезают с анимацией
4. Начисляются очки (100 за пару)

### Условия победы/поражения:
- **Победа:** все фигуры исчезли (снаружи и внутри)
- **Поражение:** круг заполнен (10 фигур внутри)

---

## Настройки в инспекторе

### InputManager

| Параметр | Описание | По умолчанию |
|----------|----------|--------------|
| Tap Radius | Радиус поиска фигуры от точки тапа | 0.5 |
| Show Debug Info | Логи в консоль | true |

### MatchManager

| Параметр | Описание | По умолчанию |
|----------|----------|--------------|
| Match Check Delay | Задержка перед проверкой матча | 0.1 |
| Points Per Match | Очки за матч | 100 |
| Show Debug Info | Логи в консоль | true |

---

## Иерархия после настройки

```
Gameplay Scene
├── Main Camera
├── EventSystem
├── GameplayController
├── RotationPivot
│   ├── CircleContainer
│   ├── OuterZone
│   └── ShapesParent
├── GameplayScaler
├── ShapeFactory
├── OuterZonePhysics
├── ShapeSpawner
├── InputManager       (NEW)
├── MatchManager       (NEW)
└── UI_Canvas
```

---

## Как тестировать

### В Play mode:

1. Нажмите Play
2. Фигуры появятся во внешней зоне
3. **Тапните/кликните по фигуре** — она полетит внутрь круга
4. Отправьте внутрь вторую такую же фигуру (тот же тип и цвет)
5. Они исчезнут с анимацией, очки +100
6. Очки отображаются в UI (зелёный текст справа вверху)

### Debug в консоли:

- `"Tapped shape: Circle Red"` — фигура тапнута
- `"Shape registered inside..."` — фигура внутри круга
- `"Match found! Circle Red"` — найден матч
- `"Match! +100 points"` — очки начислены
- `"GAME OVER - Container is full!"` — поражение
- `"VICTORY - All shapes cleared!"` — победа

---

## Ожидаемый результат

- ✅ Тап/клик по фигуре во внешней зоне отправляет её внутрь круга
- ✅ Фигура летит к центру с анимацией
- ✅ Внутри круга фигура отскакивает от стенок
- ✅ Две одинаковые фигуры внутри — исчезают с анимацией
- ✅ За каждый матч +100 очков
- ✅ Очки отображаются в UI
- ✅ Тапы над UI игнорируются
- ✅ Нельзя отправить фигуру если круг полон (10 фигур)
- ✅ Победа когда все фигуры исчезли
- ✅ Поражение когда круг заполнен

---

## Следующая итерация

**Итерация 6:** UI победы/поражения, рестарт, переход между уровнями
